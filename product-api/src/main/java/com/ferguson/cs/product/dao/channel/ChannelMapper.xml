<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ferguson.cs.product.dao.channel.ChannelMapper">
  
	 <resultMap id="channelResultMap" type="com.ferguson.cs.model.channel.Channel">
		<id column="id" jdbcType="INTEGER"  property="id" />
		<result column="code" jdbcType="VARCHAR" property="code" />
		<result column="description" jdbcType="VARCHAR" property="description" />
		<result column="channel_type" jdbcType="VARCHAR" property="channelType" />
		<result column="business_unit" jdbcType="VARCHAR" property="businessUnit" />
		<result column="is_active" jdbcType="BIT" property="isActive" />
		<result column="created_timestamp" jdbcType="TIMESTAMP" property="createdTimestamp" />
		<result column="last_modified_timestamp" jdbcType="TIMESTAMP" property="lastModifiedTimestamp" />
		<result column="version" jdbcType="SMALLINT" property="version" />
		<association property="taxonomy" javaType="TaxonomyReference">
			<id column="taxonomy_id" property="id" />
		</association>	    
	</resultMap>

	<select id="findChannels"  resultMap="channelResultMap">
		select
			id,
			code,
			description,
			channel_type,
			business_unit,
			is_active,
			taxonomy_id, 
			created_timestamp,
			last_modified_timestamp,
			version
		from channel
		<where>
			<if test="channelId != null">
			channel.id = #{channelId}
			</if>    
			<if test="channelCode != null">
			and channel.code = #{channelCode}
			</if>    
			<if test="businessUnit != null">
			and channel.business_unit = #{businessUnit}
			</if>
    	</where>    
	</select>

	<delete id="deleteChannel">
		delete from channel where id = #{id} and version = #{version}
	</delete>

	<insert id="insertChannel" useGeneratedKeys="true" keyProperty="id" keyColumn="id">
		insert into channel (
			code,
			description, 
			channel_type,
			business_unit,
			is_active, 
			taxonomy_id,
			created_timestamp,
			last_modified_timestamp, 
			version
		) values (
			#{code,jdbcType=VARCHAR},
			#{description,jdbcType=VARCHAR}, 
			#{channelType,jdbcType=VARCHAR},
			#{businessUnit,jdbcType=VARCHAR},
			#{isActive,jdbcType=BIT}, 
			#{taxonomy.id,jdbcType=INTEGER},
			#{createdTimestamp,jdbcType=TIMESTAMP},
			#{lastModifiedTimestamp,jdbcType=TIMESTAMP}, 
			1
		)

	</insert>
	<update id="updateChannel">
		update
			channel
		set
			code = #{code,jdbcType=VARCHAR},
			description = #{description,jdbcType=VARCHAR},
			channel_type = #{channelType,jdbcType=VARCHAR},
			business_unit = #{businessUnit,jdbcType=VARCHAR},
			is_active = #{isActive,jdbcType=BIT},
			taxonomy_id = #{taxonomy.id,jdbcType=INTEGER},
			created_timestamp = #{createdTimestamp,jdbcType=TIMESTAMP},
			last_modified_timestamp = #{lastModifiedTimestamp,jdbcType=TIMESTAMP},
			version = version + 1
		where
			id = #{id,jdbcType=INTEGER} and version = #{version,jdbcType=SMALLINT}
	</update>


</mapper>
