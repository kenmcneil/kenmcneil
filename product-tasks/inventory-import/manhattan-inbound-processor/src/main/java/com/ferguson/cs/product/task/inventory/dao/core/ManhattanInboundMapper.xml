<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ferguson.cs.product.task.inventory.dao.core.ManhattanInboundMapper">
	<update id="createTemporaryManhattanInventoryTable" parameterType="String">
		CREATE TABLE tempData.dbo.manhattan_${jobKey} (
		[id] [int] IDENTITY(1,1) NOT NULL,
		[quantity] [int] NOT NULL,
		[mpn] [varchar](40) NULL,
		[location] [varchar](40) NULL,
		[createDate] [smalldatetime] NULL
		) ON PRIMARY
	</update>

	<resultMap id="vendorInventoryMap" type="VendorInventory">
		<result column="mpn" property="mpn" />
		<result column="location" property="location" />
		<result column="status" property="status" />
		<result column="quantity" property="quantity" />
		<result column="jobKey" property="jobKey" />
	</resultMap>


	
	<select id="getManhattanVendorInventory" resultMap="vendorInventoryMap">
		SELECT manhattan.quantity,vm.mpn,dcVendor.vendorid AS location from omc.dbo.vendor dcVendor
		INNER JOIN omc.dbo.vendorDC dc with(NOLOCK)
		ON dcVendor.uid = dc.dcVendorUid
		INNER JOIN omc.dbo.vendor vp with(NOLOCK)
		ON dc.parentVendorUid = vp.uid
		INNER JOIN omc.dbo.Vendor_Mapping vm
		ON vp.vendorid = vm.Vendor
		INNER JOIN tempData.dbo.manhattan_#{jobKey} manhattan with(NOLOCK)
		ON dcVendor.vendorid = manhattan.location
		AND vm.mpn = manhattan.mpn
		WHERE vp.vendorid LIKE 'Ferguson%'
		AND vp.vendorid != 'Ferguson_039'
		AND vm.mpn != ''
	</select>

	<select id="getManhattanVendorInventoryZeroes" resultMap="vendorInventoryMap">
		SELECT TOP 1000000 0 AS quantity,vm.mpn,dcVendor.vendorid AS location from omc.dbo.vendor dcVendor
		INNER JOIN omc.dbo.vendorDC dc with(NOLOCK)
		ON dcVendor.uid = dc.dcVendorUid
		INNER JOIN omc.dbo.vendor vp with(NOLOCK)
		ON dc.parentVendorUid = vp.uid
		INNER JOIN omc.dbo.Vendor_Mapping vm
		ON vp.vendorid = vm.Vendor
		LEFT JOIN tempData.dbo.manhattan_#{jobKey} manhattan with(NOLOCK)
		ON dcVendor.vendorid = manhattan.location
		AND vm.mpn = manhattan.mpn
		WHERE vp.vendorid LIKE 'Ferguson%'
		AND vp.vendorid != 'Ferguson_039'
		AND manhattan.id IS NULL
		AND vm.mpn IS NOT NULL
		AND vm.mpn != ''
	</select>
</mapper>